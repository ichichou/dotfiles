title: "03. Edit Mode"

# ALIASES ========================================

aliases:

- conditions: &ime_off
  - type: input_source_unless
    input_sources:
    - language: ja

- conditions: &ime_on
  - type: input_source_if
    input_sources:
    - language: ja

- conditions: &edit
  - type: variable_if
    name: edit
    value: 1

- parameters: &thresh_ms
    basic.simultaneous_threshold_milliseconds: 50

# RULES ==========================================

rules:
- description: "3. Edit Mode"
  manipulators:

# Edit Mode Keys ---------------------------------

  # IME Off --------------------------------------

  # Left: D + F (D -> F)
  - type: basic
    from:
      simultaneous:
      - key_code: d
      - key_code: f
      simultaneous_options:
        key_down_order: strict
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: d
    - key_code: f
    conditions: *ime_off
    parameters: *thresh_ms

  # Left: D + F (D <-> F)
  - type: basic
    from:
      simultaneous:
      - key_code: d
      - key_code: f
      simultaneous_options:
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: f
    - key_code: d
    conditions: *ime_off
    parameters: *thresh_ms

  # Right: J + K (J -> K)
  - type: basic
    from:
      simultaneous:
      - key_code: j
      - key_code: k
      simultaneous_options:
        key_down_order: strict
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: j
    - key_code: k
    conditions: *ime_off
    parameters: *thresh_ms

  # Right: J + K (J <-> K)
  - type: basic
    from:
      simultaneous:
      - key_code: j
      - key_code: k
      simultaneous_options:
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: k
    - key_code: j
    conditions: *ime_off
    parameters: *thresh_ms

  # IME On (Shingeta Layout) ---------------------

  # Left: D + F (D -> F)
  - type: basic
    from:
      simultaneous:
      - key_code: d
      - key_code: f
      simultaneous_options:
        key_down_order: strict
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: k
    - key_code: a
    - key_code: "n"
    - key_code: "n"
    conditions: *ime_on
    parameters: *thresh_ms

  # Left: D + F (D <-> F)
  - type: basic
    from:
      simultaneous:
      - key_code: d
      - key_code: f
      simultaneous_options:
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: "n"
    - key_code: "n"
    - key_code: k
    - key_code: a
    conditions: *ime_on
    parameters: *thresh_ms

  # Right: J + K (J -> K)
  - type: basic
    from:
      simultaneous:
      - key_code: j
      - key_code: k
      simultaneous_options:
        key_down_order: strict
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: u
    - key_code: i
    conditions: *ime_on
    parameters: *thresh_ms

  # Right: J + K (J <-> K)
  - type: basic
    from:
      simultaneous:
      - key_code: j
      - key_code: k
      simultaneous_options:
        to_after_key_up:
        - set_variable:
            name: edit
            value: 0
    to:
    - set_variable:
        name: edit
        value: 1
    to_if_alone:
    - key_code: i
    - key_code: u
    conditions: *ime_on
    parameters: *thresh_ms

# Edit Mode Mapping -----------------------------

  # Right Keys -----------------------------------

  # Y -> Option-Delete
  - type: basic
    from:
      key_code: "y"
    to:
    - key_code: delete_or_backspace
      modifiers:
      - option
      repeat: false
    conditions: *edit

  # U -> Invalid
  - type: basic
    from:
      key_code: u
    conditions: *edit

  # I -> Command-[
  - type: basic
    from:
      key_code: i
    to:
    - key_code: open_bracket
      modifiers:
      - command
      repeat: false
    conditions: *edit

  # O -> Command-]
  - type: basic
    from:
      key_code: o
    to:
    - key_code: close_bracket
      modifiers:
      - command
      repeat: false
    conditions: *edit

  # P -> Invalid
  - type: basic
    from:
      key_code: p
    conditions: *edit

  # H -> Left
  - type: basic
    from:
      key_code: h
      modifiers:
        optional:
        - any
    to:
    - key_code: left_arrow
      repeat: true
    conditions: *edit

  # J -> Down
  - type: basic
    from:
      key_code: j
      modifiers:
        optional:
        - any
    to:
    - key_code: down_arrow
      repeat: true
    conditions: *edit

  # K -> Up
  - type: basic
    from:
      key_code: k
      modifiers:
        optional:
        - any
    to:
    - key_code: up_arrow
      repeat: true
    conditions: *edit

  # L -> Right
  - type: basic
    from:
      key_code: l
      modifiers:
        optional:
        - any
    to:
    - key_code: right_arrow
      repeat: true
    conditions: *edit

  # Semicolon -> Invalid
  - type: basic
    from:
      key_code: semicolon
    conditions: *edit

  # Quote -> Invalid
  - type: basic
    from:
      key_code: quote
    conditions: *edit

  # N -> Delete
  - type: basic
    from:
      key_code: "n"
    to:
    - key_code: delete_or_backspace
      repeat: true
    conditions: *edit

  # M -> Delete Forward
  - type: basic
    from:
      key_code: m
    to:
    - key_code: delete_forward
      repeat: true
    conditions: *edit

  # Comma -> Control-A
  - type: basic
    from:
      key_code: comma
    to:
    - key_code: a
      modifiers:
      - control
      repeat: false
    conditions: *edit

  # Period -> Control-E
  - type: basic
    from:
      key_code: period
    to:
    - key_code: e
      modifiers:
      - control
      repeat: false
    conditions: *edit

  # Slash -> Invalid
  - type: basic
    from:
      key_code: slash
    conditions: *edit

  # Return -> Maximize Window (Control-Option-Return)
  - type: basic
    from:
      key_code: return_or_enter
    to:
    - key_code: return_or_enter
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # Delete -> Restore Window (Control-Option-Delete)
  - type: basic
    from:
      key_code: delete_or_backspace
    to:
    - key_code: delete_or_backspace
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # Backslash -> Center Window (Control-Option-C)
  - type: basic
    from:
      key_code: backslash
    to:
    - key_code: c
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # Left Keys ------------------------------------

  # Q -> Invalid
  - type: basic
    from:
      key_code: q
    conditions: *edit

  # W -> Invalid
  - type: basic
    from:
      key_code: w
    conditions: *edit

  # E -> Invalid
  - type: basic
    from:
      key_code: e
    conditions: *edit

  # R -> Center Window (Shift-Control-Option-C)
  - type: basic
    from:
      key_code: r
    to:
    - key_code: c
      modifiers:
      - shift
      - control
      - option
      repeat: false
    conditions: *edit

  # T -> Shift-Command-T
  - type: basic
    from:
      key_code: t
    to:
    - key_code: t
      modifiers:
      - shift
      - command
      repeat: false
    conditions: *edit

  # A -> Left Half Window (Control-Option-Left)
  - type: basic
    from:
      key_code: a
    to:
    - key_code: left_arrow
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # S -> Left 1/3 Window (Control-Option-D)
  - type: basic
    from:
      key_code: s
    to:
    - key_code: d
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # D -> Right 1/3 Window (Control-Option-G)
  - type: basic
    from:
      key_code: d
    to:
    - key_code: g
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # F -> Right Half Window (Control-Option-Right)
  - type: basic
    from:
      key_code: f
    to:
    - key_code: right_arrow
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # G -> Invalid
  - type: basic
    from:
      key_code: g
    conditions: *edit

  # Z -> Left Quarter Window (Control-Option-Z)
  - type: basic
    from:
      key_code: z
    to:
    - key_code: z
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # X -> Left 3/4 Window (Control-Option-X)
  - type: basic
    from:
      key_code: x
    to:
    - key_code: x
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # C -> Right 3/4 Window (Control-Option-V)
  - type: basic
    from:
      key_code: c
    to:
    - key_code: v
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # V -> Right Quarter Window (Control-Option-B)
  - type: basic
    from:
      key_code: v
    to:
    - key_code: b
      modifiers:
      - control
      - option
      repeat: false
    conditions: *edit

  # B -> Invalid
  - type: basic
    from:
      key_code: b
    conditions: *edit

  # Other Keys -----------------------------------

  # Space -> Return
  - type: basic
    from:
      key_code: spacebar
    to:
    - key_code: return_or_enter
      repeat: false
    conditions: *edit
